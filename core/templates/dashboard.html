{% extends "base.html" %}

{% block title %}
    {% if role == "manager" %}
        Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ± - STAD
    {% else %}
        Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ÙˆØ¸Ù - STAD
    {% endif %}
{% endblock %}

{% block extra_css %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap');

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Cairo', sans-serif;
        background: #0a0e27;
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
    }

    /* Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© Ø¨Ø§Ù„Ù†Ø¬ÙˆÙ… */
    .stars-background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
    }

    .star {
        position: absolute;
        background: white;
        border-radius: 50%;
        animation: twinkle 3s infinite;
    }

    @keyframes twinkle {
        0%, 100% { opacity: 0.3; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.2); }
    }

    /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */
    .top-navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 70px;
        background: rgba(10, 14, 39, 0.95);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(124, 92, 219, 0.3);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 30px;
        z-index: 1000;
    }

    .navbar-brand {
        display: flex;
        align-items: center;
        gap: 15px;
        color: white;
        font-size: 1.8rem;
        font-weight: 800;
    }

    .navbar-brand img {
        height: 50px;
    }

    .navbar-actions {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .user-info {
        display: flex;
        align-items: center;
        gap: 15px;
        color: white;
    }

    .user-avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
    }

    .user-details h4 {
        font-size: 1rem;
        margin-bottom: 2px;
    }

    .user-details span {
        font-size: 0.85rem;
        color: #a78bfa;
    }

    .btn-logout {
        background: rgba(239, 68, 68, 0.2);
        color: white;
        padding: 10px 20px;
        border-radius: 10px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        border: 1px solid rgba(239, 68, 68, 0.3);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-logout:hover {
        background: rgba(239, 68, 68, 0.3);
        transform: translateY(-2px);
    }

    /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
    .sidebar {
        position: fixed;
        right: 0;
        top: 70px;
        width: 260px;
        height: calc(100vh - 70px);
        background: rgba(10, 14, 39, 0.95);
        backdrop-filter: blur(20px);
        border-left: 1px solid rgba(124, 92, 219, 0.3);
        padding: 30px 0;
        z-index: 999;
        overflow-y: auto;
    }

    .sidebar-menu {
        list-style: none;
    }

    .sidebar-item {
        margin-bottom: 10px;
    }

    .sidebar-link {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px 30px;
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        border-right: 3px solid transparent;
    }

    .sidebar-link:hover,
    .sidebar-link.active {
        background: rgba(124, 92, 219, 0.1);
        color: white;
        border-right-color: #667eea;
    }

    .sidebar-icon {
        font-size: 1.3rem;
    }

    /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
    .main-content {
        margin-right: 260px;
        margin-top: 70px;
        padding: 40px;
        position: relative;
        z-index: 1;
    }

    /* Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© */
    .dashboard-header {
        margin-bottom: 40px;
    }

    .welcome-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 25px;
        padding: 40px;
        color: white;
        position: relative;
        overflow: hidden;
    }

    .welcome-section::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        animation: rotate 20s linear infinite;
    }

    @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .welcome-content {
        position: relative;
        z-index: 1;
    }

    .welcome-content h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        font-weight: 800;
    }

    .welcome-content p {
        font-size: 1.2rem;
        opacity: 0.9;
    }

    /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø±Ù‚Ø§Ù… */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
        margin-top: 30px;
    }

    .stat-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 30px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 100px;
        height: 100px;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
        border-radius: 0 20px 0 100%;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(124, 92, 219, 0.3);
        border-color: rgba(124, 92, 219, 0.5);
    }

    .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
    }

    .stat-icon.blue {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .stat-icon.green {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .stat-icon.orange {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .stat-icon.purple {
        background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
    }

    .stat-icon.gold {
        background: linear-gradient(135deg, #f7b733 0%, #fc4a1a 100%);
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: 800;
        color: white;
        margin-bottom: 5px;
    }

    .stat-label {
        color: rgba(255, 255, 255, 0.7);
        font-size: 1rem;
    }

    .stat-change {
        font-size: 0.9rem;
        color: #4ade80;
        margin-top: 10px;
    }

    .stat-change.negative {
        color: #f87171;
    }

    /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
    .section {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 25px;
        padding: 30px;
        margin-bottom: 30px;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        flex-wrap: wrap;
        gap: 15px;
    }

    .section-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: white;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .section-icon {
        width: 45px;
        height: 45px;
        border-radius: 12px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
    }

    /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    .btn {
        padding: 12px 25px;
        border-radius: 12px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        transition: all 0.3s ease;
        cursor: pointer;
        border: none;
        font-family: 'Cairo', sans-serif;
        font-size: 1rem;
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 35px rgba(102, 126, 234, 0.6);
    }

    .btn-success {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
    }

    .btn-success:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(79, 172, 254, 0.4);
    }

    .btn-sm {
        padding: 8px 15px;
        font-size: 0.9rem;
    }

    .btn-edit {
        background: rgba(59, 130, 246, 0.2);
        color: #60a5fa;
        border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .btn-delete {
        background: rgba(239, 68, 68, 0.2);
        color: #f87171;
        border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .btn-submit {
        background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        color: white;
    }

    /* Ø§Ù„ÙÙ„Ø§ØªØ± */
    .filters {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin-bottom: 25px;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .filter-label {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.9rem;
        font-weight: 600;
    }

    .filter-select {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 10px 15px;
        color: white;
        font-family: 'Cairo', sans-serif;
        min-width: 200px;
    }

    .filter-select option {
        background: #1a1f3a;
    }

    /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
    .table-container {
        overflow-x: auto;
    }

    .data-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0 10px;
    }

    .data-table thead th {
        background: rgba(255, 255, 255, 0.05);
        color: rgba(255, 255, 255, 0.7);
        padding: 15px 20px;
        text-align: right;
        font-weight: 600;
        font-size: 0.95rem;
        border: none;
    }

    .data-table thead th:first-child {
        border-radius: 12px 0 0 12px;
    }

    .data-table thead th:last-child {
        border-radius: 0 12px 12px 0;
    }

    .data-table tbody tr {
        background: rgba(255, 255, 255, 0.03);
        transition: all 0.3s ease;
    }

    .data-table tbody tr:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: scale(1.01);
    }

    .data-table tbody td {
        padding: 20px;
        color: white;
        border: none;
    }

    .data-table tbody tr td:first-child {
        border-radius: 12px 0 0 12px;
    }

    .data-table tbody tr td:last-child {
        border-radius: 0 12px 12px 0;
    }

    .project-name {
        font-weight: 700;
        color: #60a5fa;
        font-size: 1.05rem;
    }

    .status-badge {
        display: inline-block;
        padding: 6px 15px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .status-todo {
        background: rgba(156, 163, 175, 0.2);
        color: #d1d5db;
    }

    .status-in_progress {
        background: rgba(59, 130, 246, 0.2);
        color: #60a5fa;
    }

    .status-completed {
        background: rgba(34, 197, 94, 0.2);
        color: #4ade80;
    }

    .status-blocked {
        background: rgba(239, 68, 68, 0.2);
        color: #f87171;
    }

    .status-late {
        background: rgba(248, 113, 113, 0.25);
        color: #fecaca;
        box-shadow: 0 0 10px rgba(239, 68, 68, 0.4);
    }

    /* Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© */
    .status-under_review {
        background: rgba(234, 179, 8, 0.23);  /* Ø£ØµÙØ± Ø®ÙÙŠÙ */
        color: #fde68a;                       /* Ù†Øµ Ø£ØµÙØ± ÙØ§ØªØ­ */
        box-shadow: 0 0 3px rgba(234, 179, 8, 0.4);
    }



    /* Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² */
    .progress-bar {
        width: 100%;
        height: 8px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #4ade80, #22c55e);
        border-radius: 10px;
        transition: width 0.3s ease;
    }

    .progress-text {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.7);
        margin-top: 5px;
    }

    /* Gantt Chart */
    .gantt-container {
        overflow-x: auto;
        padding: 20px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 15px;
    }

    .gantt-chart {
        min-width: 800px;
    }

    .gantt-row {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        gap: 20px;
    }

    .gantt-task-name {
        width: 200px;
        color: white;
        font-weight: 600;
        flex-shrink: 0;
    }

    .gantt-timeline {
        flex: 1;
        height: 40px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        position: relative;
        overflow: hidden;
    }

    .gantt-bar {
        position: absolute;
        height: 100%;
        border-radius: 10px;
        display: flex;
        align-items: center;
        padding: 0 15px;
        color: white;
        font-size: 0.85rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .gantt-bar:hover {
        filter: brightness(1.2);
        transform: scaleY(1.1);
    }

    .gantt-bar.status-todo {
        background: linear-gradient(90deg, #9ca3af, #6b7280);
    }

    .gantt-bar.status-in_progress {
        background: linear-gradient(90deg, #3b82f6, #2563eb);
    }

    .gantt-bar.status-completed {
        background: linear-gradient(90deg, #22c55e, #16a34a);
    }

    .gantt-bar.status-blocked {
        background: linear-gradient(90deg, #ef4444, #dc2626);
    }

    /* Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…Ù‡Ù…Ø© */
    .submit-form {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 25px;
        margin-top: 20px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-label {
        color: rgba(255, 255, 255, 0.8);
        font-weight: 600;
        margin-bottom: 10px;
        display: block;
    }

    .form-input,
    .form-textarea {
        width: 100%;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 12px 15px;
        color: white;
        font-family: 'Cairo', sans-serif;
        transition: all 0.3s ease;
    }

    /* ØªØµØ­ÙŠØ­ Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© ÙÙŠ "Ø§Ø®ØªÙØ± Ø§Ù„Ù…Ù‡Ù…Ø©" */
    select.form-input option {
        color: #000;      /* Ù†Øµ Ø£Ø³ÙˆØ¯ Ø¹Ø´Ø§Ù† ÙŠØ¨Ø§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ */
        background: #fff; /* Ø®Ù„ÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ Ø²ÙŠ Ù…Ø§ ØªØ­Ø¨ */
}


    .form-input:focus,
    .form-textarea:focus {
        outline: none;
        border-color: #667eea;
        background: rgba(255, 255, 255, 0.08);
    }

    .form-textarea {
        min-height: 120px;
        resize: vertical;
    }

    .file-upload {
        border: 2px dashed rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .file-upload.drag-over {
        border-color: #667eea;
        background: rgba(102, 126, 234, 0.05);
}

    .file-name {
        direction: ltr; /* Ø¹Ø´Ø§Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ù…Ø§ ÙŠÙ†Ù‚Ù„Ø¨ */
}


    .file-upload:hover {
        border-color: #667eea;
        background: rgba(102, 126, 234, 0.05);
    }

    .file-upload-icon {
        font-size: 3rem;
        margin-bottom: 10px;
        opacity: 0.5;
    }

    /* Ø¶ØºØ· Ø§Ù„Ø¹Ù…Ù„ */
    .workload-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
    }

    .workload-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 20px;
        transition: all 0.3s ease;
    }

    .workload-card:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(124, 92, 219, 0.3);
    }

    .employee-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
    }

    .employee-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
    }

    .employee-info h4 {
        color: white;
        font-size: 1.1rem;
        margin-bottom: 3px;
    }

    .employee-info span {
        color: rgba(255, 255, 255, 0.6);
        font-size: 0.9rem;
    }

    .workload-level {
        margin-top: 15px;
    }

    .workload-bar {
        width: 100%;
        height: 10px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        overflow: hidden;
        margin-top: 8px;
    }

    .workload-fill {
        height: 100%;
        border-radius: 10px;
        transition: width 0.3s ease;
    }

    .workload-fill.low {
        background: linear-gradient(90deg, #4ade80, #22c55e);
        width: 30%;
    }

    .workload-fill.medium {
        background: linear-gradient(90deg, #fbbf24, #f59e0b);
        width: 60%;
    }

    .workload-fill.high {
        background: linear-gradient(90deg, #f87171, #ef4444);
        width: 90%;
    }

    /* Ù„ÙˆØ­Ø© Ø§Ù„Ù†Ø´Ø§Ø· */
    .activity-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .activity-item {
        display: flex;
        gap: 15px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 12px;
        border-right: 3px solid #667eea;
    }

    .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        flex-shrink: 0;
    }

    .activity-content h4 {
        color: white;
        font-size: 1rem;
        margin-bottom: 5px;
    }

    .activity-content p {
        color: rgba(255, 255, 255, 0.6);
        font-size: 0.9rem;
    }

    .activity-time {
        color: rgba(255, 255, 255, 0.5);
        font-size: 0.85rem;
        margin-top: 5px;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: rgba(255, 255, 255, 0.5);
    }

    .empty-state-icon {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.3;
    }

    .empty-state p {
        font-size: 1.1rem;
    }

    /* Tabs Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ */
    .project-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 25px;
        flex-wrap: wrap;
    }

    .tab-btn {
        padding: 10px 20px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        color: rgba(255, 255, 255, 0.7);
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Cairo', sans-serif;
        font-weight: 600;
    }

    .tab-btn.active,
    .tab-btn:hover {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: transparent;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    .charts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 25px;
        align-items: stretch;  
    }


    .chart-card {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 25px;
        backdrop-filter: blur(10px);

        display: flex;
        flex-direction: column;
        justify-content: center;

        min-height: 280px;
        height: 100%;           
    }   



    .chart-title {
        color: #ffffff;
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 15px;
    }

    .workload-wrapper {
        position: relative;
        width: 220px;
        height: 220px;
        margin: 0 auto;
    }

    .workload-wrapper canvas {
        width: 100% !important;
        height: 100% !important;
    }

    .workload-center {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        pointer-events: none;
        text-align: center;
    }

    .workload-number {
        font-size: 2rem;
        font-weight: 800;
        color: #ffffff;
        line-height: 1;
    }

    .workload-total {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.9rem;
        margin-bottom: 5px;
    }

    .workload-text {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.85rem;
    }

    .chart-card canvas {
        max-height: 260px !important;
        max-width: 260px !important;
        margin: 0 auto;
        display: block;
    }

        /* Legend styling for Tasks by Status */
    .chartjs-legend {
        margin-top: 20px;
    }

    .chartjs-legend ul {
        display: flex !important;
        justify-content: center !important;
        flex-wrap: wrap !important;
        gap: 18px !important;
        padding-left: 0 !important;
        margin: 0;
    }

    .chartjs-legend li {
        display: flex !important;
        align-items: center !important;
        gap: 6px !important;
        list-style: none !important;
        font-size: 14px !important;
        color: #ffffff;
        opacity: 0.9;
    }

    .chartjs-legend li span {
        width: 14px !important;
        height: 14px !important;
        border-radius: 50% !important;
        display: inline-block;
    }



    /* Responsive */
    @media (max-width: 1024px) {
        .sidebar {
            transform: translateX(260px);
        }

        .main-content {
            margin-right: 0;
        }

        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }

        .filters {
            flex-direction: column;
        }

        .filter-select {
            width: 100%;
        }

        .section-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .workload-grid {
            grid-template-columns: 1fr;
        }

        .gantt-task-name {
            width: 150px;
        }
    }

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-content {
    background: white;
    margin: 5% auto;
    width: 90%;
    max-width: 700px;
    border-radius: 20px;
    box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
    animation: slideDown 0.3s ease;
    overflow: hidden;
}

@keyframes slideDown {
    from {
        transform: translateY(-50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.modal-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 25px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    margin: 0;
    font-size: 1.8rem;
    font-weight: 700;
}

.modal-close {
    font-size: 2.5rem;
    font-weight: 300;
    cursor: pointer;
    transition: all 0.3s ease;
    line-height: 1;
}

.modal-close:hover {
    transform: rotate(90deg);
    color: #fbbf24;
}

.modal-body {
    max-height: 70vh; /* âœ… Ø£Ù‚ØµÙ‰ Ø§Ø±ØªÙØ§Ø¹ 70% Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© */
    overflow-y: auto; /* âœ… ØªÙØ¹ÙŠÙ„ scroll Ø¹Ù…ÙˆØ¯ÙŠ */
    padding: 35px 30px;
}

.modal-form-group {
    margin-bottom: 25px;
}

.modal-form-group label {
    display: block;
    font-size: 1.05rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 10px;
}

.modal-input,
.modal-textarea {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 1rem;
    font-family: 'Cairo', sans-serif;
    transition: all 0.3s ease;
    background: #f7fafc;
}

.modal-input:focus,
.modal-textarea:focus {
    outline: none;
    border-color: #667eea;
    background: white;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
}

.modal-textarea {
    resize: vertical;
}

.modal-form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.modal-actions {
    display: flex;
    gap: 15px;
    margin-top: 30px;
    padding-top: 25px;
    border-top: 1px solid #e2e8f0;
}

.btn-modal-cancel {
    flex: 1;
    padding: 14px 25px;
    background: #e2e8f0;
    color: #4a5568;
    border: none;
    border-radius: 10px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    font-family: 'Cairo', sans-serif;
    transition: all 0.3s ease;
}

.btn-modal-cancel:hover {
    background: #cbd5e0;
    transform: translateY(-2px);
}

.btn-modal-save {
    flex: 2;
    padding: 14px 25px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    font-family: 'Cairo', sans-serif;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.btn-modal-save:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
}

.tab-content {
    max-height: 500px;        /* Ù†ÙØ³ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ù„ÙƒÙ„ Ø§Ù„ØªØ§Ø¨Ø§Øª */
    overflow-y: auto;         /* Ø³ÙƒØ±ÙˆÙ„ Ø¯Ø§Ø®Ù„ÙŠ */
    overflow-x: hidden;
    padding-right: 5px;
}

/* Ø´ÙƒÙ„ Ø§Ù„Ø³ÙƒØ±ÙˆÙˆÙ„ */
.tab-content::-webkit-scrollbar {
    width: 6px;
}

.tab-content::-webkit-scrollbar-thumb {
    background: #4b6bdc;
    border-radius: 10px;
}

.tab-content::-webkit-scrollbar-track {
    background: transparent;
}



@media (max-width: 768px) {
    .modal-content {
        width: 95%;
        margin: 10% auto;
    }

    .modal-form-row {
        grid-template-columns: 1fr;
    }
}
/* Delete Modal Specific Styles */
.delete-modal .modal-content {
    max-width: 550px;
}

.delete-header {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
}

.warning-icon {
    font-size: 5rem;
    text-align: center;
    margin: 20px 0;
    animation: shake 0.5s ease;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    75% { transform: translateX(10px); }
}

.warning-box {
    background: #fef2f2;
    border: 2px solid #fecaca;
    border-radius: 12px;
    padding: 20px;
    margin: 25px 0;
}

.warning-box p {
    color: #991b1b;
    font-size: 1rem;
    margin: 0;
    font-weight: 600;
}

.btn-modal-delete {
    flex: 2;
    padding: 14px 25px;
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    font-family: 'Cairo', sans-serif;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
}

.btn-modal-delete:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(239, 68, 68, 0.6);
}
/* Task Details Modal */
.task-details-modal .modal-content {
    max-width: 650px;
}

.task-header {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important;
}

.task-detail-row {
    display: flex;
    gap: 20px;
    padding: 20px;
    background: #f7fafc;
    border-radius: 12px;
    margin-bottom: 15px;
    transition: all 0.3s ease;
    border-right: 4px solid transparent;
}

.task-detail-row:hover {
    background: #edf2f7;
    border-right-color: #4facfe;
}

.description-row {
    background: #fff;
    border: 2px solid #e2e8f0;
}

.detail-icon {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    flex-shrink: 0;
}

.detail-content {
    flex: 1;
}

.detail-label {
    font-size: 0.9rem;
    color: #718096;
    font-weight: 600;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.detail-value {
    font-size: 1.2rem;
    color: #2d3748;
    font-weight: 700;
    margin: 0;
}

.detail-description {
    font-size: 1.05rem;
    color: #4a5568;
    line-height: 1.8;
    padding: 15px;
    background: #f7fafc;
    border-radius: 8px;
    min-height: 80px;
    white-space: pre-wrap;
}

.detail-description:empty::before {
    content: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø©';
    color: #a0aec0;
    font-style: italic;
}

/* Field Help Text */
.field-help {
    display: block;
    font-size: 0.85rem;
    color: #718096;
    margin-top: 8px;
    font-style: italic;
}

/* ØªØ­Ø³ÙŠÙ† Select Box */
.modal-input[type="date"],
select.modal-input {
    cursor: pointer;
}

select.modal-input {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23667eea' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: left 15px center;
    padding-left: 40px;
}

select.modal-input option {
    padding: 10px;
    background: white;
    color: #2d3748;
}

/* Task Add Header */
.task-add-header {
    background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%) !important;
}



/* ==================== Modern Task Modal ==================== */
.modal-overlay-task {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10001;
}

.modal-overlay-task.show {
    display: flex;
}

.modal-box-task {
    background: white;
    width: 100%;
    max-width: 550px;
    border-radius: 12px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    overflow: hidden;
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header-task {
    background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
    color: white;
    padding: 20px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header-task h2 {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0;
}

.close-btn-task {
    background: none;
    border: none;
    font-size: 1.8rem;
    color: white;
    cursor: pointer;
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: all 0.2s;
    line-height: 1;
}

.close-btn-task:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: rotate(90deg);
}

.modal-body-task {
    padding: 24px;
    max-height: 70vh;
    overflow-y: auto;
}

.field-task {
    margin-bottom: 20px;
}

.label-task {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
}

.required-star {
    color: #ef4444;
}

.input-task,
.textarea-task,
.select-task {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    font-size: 0.875rem;
    font-family: 'Cairo', sans-serif;
    color: #111827;
    transition: all 0.2s;
    background: white;
}

.input-task:focus,
.textarea-task:focus,
.select-task:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.textarea-task {
    resize: vertical;
    min-height: 80px;
}

/* Skills Chips */
.skills-label-task {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    color: #374151;
    margin-bottom: 12px;
}

.skills-box-task {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.chip-task {
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    border: 1px solid #e5e7eb;
    background: white;
    color: #6b7280;
}

.chip-task:hover {
    border-color: #3b82f6;
    background: #eff6ff;
    color: #3b82f6;
}

.chip-task.active {
    background: #3b82f6;
    color: white;
    border-color: #3b82f6;
}

/* Employee Assignment */
.assign-row-task {
    display: flex;
    align-items: center;
    gap: 12px;
}

.assign-row-task .select-task {
    flex: 1;
}

.smart-btn-task {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 10px 16px;
    background: white;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 500;
    color: #374151;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
    font-family: 'Cairo', sans-serif;
}

.smart-btn-task:hover {
    background: #f9fafb;
    border-color: #9ca3af;
}

.smart-btn-task.active {
    background: #3b82f6;
    color: white;
    border-color: #3b82f6;
}

/* Smart Suggestion Card */
.suggestion-card-task {
    margin-top: 16px;
    padding: 16px;
    background: #f0f9ff;
    border: 1px solid #bae6fd;
    border-radius: 8px;
    display: none;
}

.suggestion-card-task.show {
    display: block;
}

.suggestion-badge-task {
    background: #3b82f6;
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    display: inline-block;
    margin-bottom: 12px;
}

.employee-card-task {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: white;
    border-radius: 8px;
}

.avatar-task {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.emp-details-task {
    flex: 1;
}

.emp-name-task {
    font-size: 0.875rem;
    font-weight: 600;
    color: #111827;
    margin-bottom: 2px;
}

.emp-role-task {
    font-size: 0.75rem;
    color: #6b7280;
}

.match-badge-task {
    background: #10b981;
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
}

.reasons-box-task {
    margin-top: 12px;
    padding: 12px;
    background: white;
    border-radius: 8px;
}

.reasons-box-task p {
    font-size: 0.75rem;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
}

.reasons-box-task ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.reasons-box-task li {
    font-size: 0.75rem;
    color: #6b7280;
    padding: 4px 0;
    padding-right: 16px;
    position: relative;
}

.reasons-box-task li::before {
    content: 'âœ“';
    position: absolute;
    right: 0;
    color: #10b981;
    font-weight: 700;
}

/* Loading */
.loading-task {
    text-align: center;
    padding: 20px;
    color: #6b7280;
}

.spinner-task {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid #e5e7eb;
    border-top-color: #3b82f6;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Submit Button */
.submit-btn-task {
    width: 100%;
    padding: 12px;
    background: #3b82f6;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Cairo', sans-serif;
    margin-top: 24px;
}

.submit-btn-task:hover {
    background: #2563eb;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

/* Scrollbar */
.modal-body-task::-webkit-scrollbar {
    width: 6px;
}

.modal-body-task::-webkit-scrollbar-track {
    background: #f3f4f6;
}

.modal-body-task::-webkit-scrollbar-thumb {
    background: #d1d5db;
    border-radius: 3px;
}

@media (max-width: 640px) {
    .assign-row-task {
        flex-direction: column;
    }
    .smart-btn-task {
        width: 100%;
        justify-content: center;
    }
}

</style>
{% endblock %}

{% block content %}
    <!-- Ø®Ù„ÙÙŠØ© Ø§Ù„Ù†Ø¬ÙˆÙ… -->
    <div class="stars-background" id="starsBackground"></div>

    <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
    <nav class="top-navbar">
        <div class="navbar-brand">
            {% load static %}
            <img src="{% static 'images/logo.png' %}" alt="STAD">
            <span>STAD</span>
        </div>
        <div class="navbar-actions">
            <div class="user-info">
                <div class="user-avatar">
                    {% if role == "manager" %}ğŸ‘¨â€ğŸ’¼{% else %}ğŸ‘¨â€ğŸ’»{% endif %}
                </div>
                <div class="user-details">
                    <h4>{{ request.user.first_name|default:request.user.username }}</h4>
                    <span>{% if role == "manager" %}Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…{% else %}Ù…ÙˆØ¸Ù{% endif %}</span>
                </div>
            </div>
            <a href="{% url 'logout' %}" class="btn-logout">
                <span>ğŸšª</span>
                <span>ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</span>
            </a>
        </div>
    </nav>

    <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
    <aside class="sidebar">
        <ul class="sidebar-menu">
            <li class="sidebar-item">
                <a href="{% url 'dashboard' %}" class="sidebar-link active">
                    <span class="sidebar-icon">ğŸ“Š</span>
                    <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
                </a>
            </li>
            {% if role == "manager" %}
            <li class="sidebar-item">
                <a href="#projects" class="sidebar-link">
                    <span class="sidebar-icon">ğŸ“</span>
                    <span>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#tasks" class="sidebar-link">
                    <span class="sidebar-icon">âœ…</span>
                    <span>Ø§Ù„Ù…Ù‡Ø§Ù…</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#employees" class="sidebar-link">
                    <span class="sidebar-icon">ğŸ‘¥</span>
                    <span>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="{% url 'submissions' %}" class="sidebar-link">
                    <span class="sidebar-icon">ğŸ“¤</span>
                    <span>Ø§Ù„ØªØ³Ù„ÙŠÙ…Ø§Øª</span>
                </a>
            </li>
            {% else %}
            <li class="sidebar-item">
                <a href="#my-projects" class="sidebar-link">
                    <span class="sidebar-icon">ğŸ“</span>
                    <span>Ù…Ø´Ø§Ø±ÙŠØ¹ÙŠ</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#my-tasks" class="sidebar-link">
                    <span class="sidebar-icon">âœ…</span>
                    <span>Ù…Ù‡Ø§Ù…ÙŠ</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#timeline" class="sidebar-link">
                    <span class="sidebar-icon">ğŸ“Š</span>
                    <span>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ù‡Ø§Ù…ÙŠ </span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#submit-task" class="sidebar-link">
                    <span class="sidebar-icon">ğŸ“¤</span>
                    <span>ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…Ù‡Ø§Ù…</span>
                </a>
            </li>
            {% endif %}
            <li class="sidebar-item">
                <a href="{% url 'home' %}" class="sidebar-link">
                    <span class="sidebar-icon">ğŸ </span>
                    <span>Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
                </a>
            </li>
        </ul>
    </aside>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <main class="main-content">
        <!-- ØªØ±ÙˆÙŠØ³Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
        <div class="dashboard-header">
            <div class="welcome-section">
                <div class="welcome-content">
                    <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ {{ request.user.first_name|default:request.user.username }} ğŸ‘‹</h1>
                    <p>
                        {% if role == "manager" %}
                            Ø¥Ù„ÙŠÙƒ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¡ ÙØ±ÙŠÙ‚Ùƒ ÙˆÙ…Ø´Ø§Ø±ÙŠØ¹Ùƒ Ø§Ù„Ù†Ø´Ø·Ø©
                        {% else %}
                            Ø¥Ù„ÙŠÙƒ Ù†Ø¸Ø±Ø© Ø¹Ù„Ù‰ Ù…Ù‡Ø§Ù…Ùƒ ÙˆÙ…Ø´Ø§Ø±ÙŠØ¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                        {% endif %}
                    </p>
                </div>
            </div>

            <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
            <div class="stats-grid">
                {% if role == "manager" %}
<div class="stat-card">
    <div class="stat-header">
        <div class="stat-icon blue">ğŸ“</div>
    </div>
    <div class="stat-number">{{ total_tasks }}</div>
    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…</div>
    <div class="stat-change">
        {% if total_tasks %}
            Ù„Ø¯ÙŠÙƒ {{ total_tasks }} Ù…Ù‡Ù…Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…
        {% else %}
            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†
        {% endif %}
    </div>
</div>

<div class="stat-card">
    <div class="stat-header">
        <div class="stat-icon green">âœ…</div>
    </div>
    <div class="stat-number">{{ completed_tasks }}</div>
    <div class="stat-label">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div>
    <div class="stat-change">
        {% if total_tasks %}
            {{ completed_tasks }} Ù…Ù† {{ total_tasks }} Ù…Ù‡Ø§Ù… Ù…ÙƒØªÙ…Ù„Ø©
        {% else %}
            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù„Ø¹Ø±Ø¶Ù‡Ø§
        {% endif %}
    </div>
</div>

<div class="stat-card">
    <div class="stat-header">
        <div class="stat-icon orange">â°</div>
    </div>
    <div class="stat-number">{{ overdue_tasks }}</div>
    <div class="stat-label">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©</div>
    <div class="stat-change negative">
        {% if overdue_tasks %}
            ØªØ­ØªØ§Ø¬ Ù…ØªØ§Ø¨Ø¹Ø© ÙÙˆØ±ÙŠØ©
        {% else %}
            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…ØªØ£Ø®Ø±Ø© ğŸ‰
        {% endif %}
    </div>
</div>

<div class="stat-card">
    <div class="stat-header">
        <div class="stat-icon purple">ğŸ“</div>
    </div>
    <div class="stat-number">{{ active_projects }}</div>
    <div class="stat-label">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù†Ø´Ø·Ø©</div>
    <div class="stat-change">
        {% if active_projects %}
            {{ active_projects }} Ù…Ø´Ø±ÙˆØ¹ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…
        {% else %}
            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¨Ø¹Ø¯
        {% endif %}
    </div>
</div>
{% else %}

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon blue">âœ…</div>
                    </div>
                    <div class="stat-number">{{ total_tasks|default:0 }}</div>
                    <div class="stat-label">Ù…Ù‡Ø§Ù…ÙŠ</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon green">ğŸ¯</div>
                    </div>
                    <div class="stat-number">{{ completed_tasks|default:0 }}</div>
                    <div class="stat-label">Ù…Ù‡Ø§Ù… Ù…ÙƒØªÙ…Ù„Ø©</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon orange">â³</div>
                    </div>
                    <div class="stat-number">{{ in_progress_tasks|default:0 }}</div>
                    <div class="stat-label">Ù…Ù‡Ø§Ù… Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</div>
                </div>

                <div class="stat-card">
    <div class="stat-header">
        <div class="stat-icon purple">â°</div>
    </div>
    <div class="stat-number">{{ overdue_tasks|default:0 }}</div>
    <div class="stat-label">Ù…Ù‡Ø§Ù… Ù…ØªØ£Ø®Ø±Ø©</div>
</div>

<!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ… -->
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon gold">â­</div>
                    </div>
                    <div class="stat-number">
                        {% if overall_rating > 0 %}
                            {{ overall_rating|floatformat:1 }} / 5.0
                        {% else %}
                            -- / 5.0
                        {% endif %}
                    </div>
                    <div class="stat-label">ØªÙ‚ÙŠÙŠÙ…ÙŠ</div>
                    <div class="stat-change">
                        {% if rating_count > 0 %}
                            Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ {{ rating_count }} ØªÙ‚ÙŠÙŠÙ…
                        {% else %}
                            Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø¨Ø¹Ø¯
                        {% endif %}
                    </div>
                </div>

                {% endif %}
            </div>
        </div>

        {% if role == "manager" %}
        <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¯ÙŠØ± -->
        
        <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ -->
        <section class="section" id="projects">
            <div class="section-header">
                <div class="section-title">
                    <div class="section-icon">ğŸ“</div>
                    <span>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</span>
                </div>
                <button class="btn btn-primary" onclick="openAddProjectModal()">
                    <span>â•</span>
                    <span>Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</span>
                </button>
            </div>

            {% if projects %}
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th>
                            <th>Ø§Ù„Ù…Ø¯ÙŠØ±</th>
                            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ø§Ù…</th>
                            <th>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for project in projects %}
                        <tr>
                            <td class="project-name">{{ project.name }}</td>
                            <td>
                                {% if project.manager %}
                                    {{ project.manager.first_name|default:project.manager.username }}
                                {% else %}
                                    <span style="color: rgba(255,255,255,0.4)">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>
                                {% endif %}
                            </td>
                            <td>{{ project.tasks.count|default:0 }}</td>
                            <td>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: {{ project.completion }}%"></div>
                                </div>
                                <div class="progress-text">{{ project.completion }}%</div>
                            </td>
                            <td>{{ project.start_date|date:"Y-m-d"|default:"â€”" }}</td>
                            <td>{{ project.end_date|date:"Y-m-d"|default:"â€”" }}</td>
                            <td>
                                <button class="btn btn-sm btn-edit" onclick="openEditModal({{ project.id }}, '{{ project.name }}', '{{ project.description|escapejs }}', '{{ project.start_date|date:'Y-m-d'|default:'' }}', '{{ project.end_date|date:'Y-m-d'|default:'' }}')">âœï¸</button>
                                <button class="btn btn-sm btn-delete" onclick="openDeleteModal({{ project.id }}, '{{ project.name|escapejs }}')"> ğŸ—‘ï¸</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ“</div>
                <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
            </div>
            {% endif %}
        </section>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ù‡Ø§Ù… Ù„Ù„Ù…Ø¯ÙŠØ± Ù…Ø¹ Tabs -->
        <section class="section" id="tasks">
            <div class="section-header">
                <div class="section-title">
                    <div class="section-icon">âœ…</div>
                    <span>Ø§Ù„Ù…Ù‡Ø§Ù…</span>
                </div>
                <button class="btn btn-success" onclick="openTaskModal()">
                    <span>â•</span>
                    <span>Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                </button>

            </div>

            <!-- Tabs Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ + Ù…Ù‡Ø§Ù… Ù…Ø³ØªÙ‚Ù„Ø© -->
            <div class="project-tabs">
                <button class="tab-btn" onclick="showTab('all-tasks')">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…</button>
                <button class="tab-btn" onclick="showTab('standalone-tasks')">Ù…Ù‡Ø§Ù… Ù…Ø³ØªÙ‚Ù„Ø©</button>
                {% for project in projects %}
                <button class="tab-btn" onclick="showTab('project-{{ project.id }}')">{{ project.name }}</button>
                {% endfor %}
            </div>

<!-- Ø§Ù„ÙÙ„Ø§ØªØ± -->
<form method="get" class="filters">
    <!-- ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„Ø© -->
    <div class="filter-group">
        <label class="filter-label">Ø§Ù„Ø­Ø§Ù„Ø©</label>
        <select name="status" class="filter-select" onchange="this.form.submit()">
            <option value=""
                {% if not selected_status_manager %}selected{% endif %}>
                Ø§Ù„ÙƒÙ„
            </option>
            <option value="todo"
                {% if selected_status_manager == 'todo' %}selected{% endif %}>
                Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
            </option>
            <option value="in_progress"
                {% if selected_status_manager == 'in_progress' %}selected{% endif %}>
                Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°
            </option>
            <option value="under_review"
                {% if selected_status_manager == 'under_review' %}selected{% endif %}>
                 ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
            </option>
            <option value="completed"
                {% if selected_status_manager == 'completed' %}selected{% endif %}>
                Ù…ÙƒØªÙ…Ù„Ø©
            </option>
            <option value="blocked"
                {% if selected_status_manager == 'blocked' %}selected{% endif %}>
                Ù…Ø¹Ù„Ù‚Ø©
            </option>
                <option value="late"
                 {% if selected_status_manager == 'late' %}selected{% endif %}>
                 Ù…ØªØ£Ø®Ø±Ø©
            </option>

        </select>
    </div>

    <!-- ÙÙ„ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù -->
    <div class="filter-group">
        <label class="filter-label">Ø§Ù„Ù…ÙˆØ¸Ù</label>
        <select name="employee" class="filter-select" onchange="this.form.submit()">
    <option value=""
        {% if selected_employee == "" %}selected="selected"{% endif %}>
        Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
    </option>

    {% for emp in workload_employees %}
        <option value="{{ emp.id }}"
            {% if selected_employee == emp.id|stringformat:"s" %}selected="selected"{% endif %}>
            {{ emp.name }}
        </option>
    {% endfor %}
</select>


    </div>
</form>


            <!-- Ù…Ø­ØªÙˆÙ‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… -->
            <div id="all-tasks" class="tab-content active">
                {% if tasks %}
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ù‡Ù…Ø©</th>
                                <th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th>
                                <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for task in tasks %}
                            <tr>
                                <td><strong>{{ task.title }}</strong></td>
                                <td>
                                    {% if task.project %}
                                        <span class="project-name">{{ task.project.name }}</span>
                                    {% else %}
                                        <span style="color: #fbbf24;">â­ Ù…Ù‡Ù…Ø© Ù…Ø³ØªÙ‚Ù„Ø©</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if task.assignee %}
                                        {{ task.assignee.first_name|default:task.assignee.username }}
                                    {% else %}
                                        <span style="color: rgba(255,255,255,0.4)">ØºÙŠØ± Ù…ÙƒÙ„ÙØ©</span>
                                    {% endif %}
                                </td>
                                <td>
    <span class="status-badge status-{{ task.status }}">
        {{ task.get_status_display }}
    </span>
</td>


                                <td>{{ task.due_date|date:"Y-m-d"|default:"â€”" }}</td>
                                <td>
                                    <button class="btn btn-sm btn-edit" onclick="openEditTaskModal({{ task.id }}, '{{ task.title|escapejs }}', '{{ task.description|escapejs|default:'' }}', '{% if task.project %}{{ task.project.id }}{% endif %}', '{% if task.assignee %}{{ task.assignee.id }}{% endif %}', '{{ task.status }}', '{{ task.due_date|date:'Y-m-d'|default:'' }}')">âœï¸</button>
                                    <button class="btn btn-sm btn-delete" onclick="openDeleteTaskModal({{ task.id }}, '{{ task.title|escapejs }}')">ğŸ—‘ï¸</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">âœ…</div>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
                </div>
                {% endif %}
            </div>

            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ù„Ø© -->
            <div id="standalone-tasks" class="tab-content">
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ù‡Ù…Ø©</th>
                                <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for task in tasks %}
                                {% if not task.project %}
                                <tr>
                                    <td><strong>{{ task.title }}</strong></td>
                                    <td>
                                        {% if task.assignee %}
                                            {{ task.assignee.first_name|default:task.assignee.username }}
                                        {% else %}
                                            <span style="color: rgba(255,255,255,0.4)">ØºÙŠØ± Ù…ÙƒÙ„ÙØ©</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="status-badge status-{{ task.status }}">
                                            {{ task.get_status_display }}
                                        </span>
                                    </td>
                                    <td>{{ task.due_date|date:"Y-m-d"|default:"â€”" }}</td>
                                    <td>
                                        <button class="btn btn-sm btn-edit">âœï¸</button>
                                        <button class="btn btn-sm btn-delete">ğŸ—‘ï¸</button>
                                    </td>
                                </tr>
                                {% endif %}
                            {% empty %}
                                <tr>
                                    <td colspan="5">
                                        <div class="empty-state">
                                            <div class="empty-state-icon">â­</div>
                                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…Ø³ØªÙ‚Ù„Ø©</p>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Ù…Ø­ØªÙˆÙ‰ Ù…Ù‡Ø§Ù… ÙƒÙ„ Ù…Ø´Ø±ÙˆØ¹ -->
            {% for project in projects %}
            <div id="project-{{ project.id }}" class="tab-content">
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ù‡Ù…Ø©</th>
                                <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for task in tasks %}
                                {% if task.project.id == project.id %}
                                <tr>
                                    <td><strong>{{ task.title }}</strong></td>
                                    <td>
                                        {% if task.assignee %}
                                            {{ task.assignee.first_name|default:task.assignee.username }}
                                        {% else %}
                                            <span style="color: rgba(255,255,255,0.4)">ØºÙŠØ± Ù…ÙƒÙ„ÙØ©</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="status-badge status-{{ task.status }}">
                                            {{ task.get_status_display }}
                                        </span>
                                    </td>
                                    <td>{{ task.due_date|date:"Y-m-d"|default:"â€”" }}</td>
                                    <td>
                                        <button class="btn btn-sm btn-edit">âœï¸</button>
                                        <button class="btn btn-sm btn-delete">ğŸ—‘ï¸</button>
                                    </td>
                                </tr>
                                {% endif %}
                            {% empty %}
                                <tr>
                                    <td colspan="5">
                                        <div class="empty-state">
                                            <div class="empty-state-icon">âœ…</div>
                                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</p>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endfor %}
        </section>

<!-- Ù‚Ø³Ù… Ø¶ØºØ· Ø§Ù„Ø¹Ù…Ù„ -->
<section class="section" id="employees">
    <div class="section-header">
        <div class="section-title">
            <div class="section-icon">ğŸ‘¥</div>
            <span>Ø¶ØºØ· Ø§Ù„Ø¹Ù…Ù„ - Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</span>
        </div>
    </div>

    <div class="workload-grid">
    {% for emp in workload_employees %}
        <div class="workload-card">
            <div class="employee-header">
                <div class="employee-avatar">
                    {% if emp.level == "low" %} ğŸŸ¢
                    {% elif emp.level == "medium" %} ğŸŸ¡
                    {% else %} ğŸ”´
                    {% endif %}
                </div>

                <div class="employee-info">
                    <h4>{{ emp.name  }}</h4>
                    <span>{{ emp.role }}</span>
                </div>
            </div>

            <div class="workload-level">
                <span style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">
                    {{ emp.workload }} Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¶ØºØ·
                </span>

                <div class="workload-bar">
                    <div class="workload-fill {{ emp.level }}"
                            style="width: {% if emp.workload > 0 %}{{ emp.workload|floatformat:0 }}0%{% else %}0{% endif %};">
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
</div>

</section>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù†Ø´Ø§Ø· -->
<section class="section">
    <div class="section-header">
        <div class="section-title">
            <div class="section-icon">ğŸ””</div>
            <span>Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</span>
        </div>
    </div>

    <div class="activity-list">

        {% for log in activities %}
        <div class="activity-item">
            <div class="activity-icon">
                {% if log.action_type == "task_created" %}
                    ğŸ“
                {% elif log.action_type == "task_updated" %}
                    â™»ï¸
                {% elif log.action_type == "task_completed" %}
                    âœ…
                {% elif log.action_type == "submission_added" %}
                    ğŸ“¤
                {% elif log.action_type == "project_created" %}
                    ğŸ“
                {% else %}
                    ğŸ“Œ
                {% endif %}
            </div>

            <div class="activity-content">
                <h4>{{ log.message }}</h4>

                <p>
                    Ø¨ÙˆØ§Ø³Ø·Ø©
                    <strong>{{ log.user.username }}</strong>
                </p>

                <span class="activity-time">
                    {{ log.timestamp|timesince }} ago
                </span>
            </div>
        </div>
        {% endfor %}

        {% if activities|length == 0 %}
        <div class="activity-item">
            <div class="activity-icon">ğŸ“­</div>
            <div class="activity-content">
                <h4>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø´Ø§Ø·Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</h4>
            </div>
        </div>
        {% endif %}
    </div>
</section>



<!-- ===== Ù‚Ø³Ù… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===== -->
<div class="export-section" style="background: rgba(255,255,255,0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 30px; margin-bottom: 30px;">
    <h3 style="color: white; margin-bottom: 20px; font-size: 1.5rem; display: flex; align-items: center; gap: 10px;">
        <span>ğŸ“¥</span>
        <span>ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø³Ù… </span>
    </h3>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
        
        <!-- ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
        <a href="{% url 'export_employees_excel' %}" class="export-btn">
            <div class="export-icon">ğŸ‘¥</div>
            <div class="export-info">
                <h4>ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h4>
                <p>Ù…Ù‡Ø§Ø±Ø§Øª + ØªÙ‚ÙŠÙŠÙ…Ø§Øª + Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</p>
            </div>
        </a>
        
        <!-- ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù‡Ø§Ù… -->
        <a href="{% url 'export_tasks_excel' %}" class="export-btn">
            <div class="export-icon">ğŸ“‹</div>
            <div class="export-info">
                <h4>ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù‡Ø§Ù…</h4>
                <p>ØªÙØ§ØµÙŠÙ„ ÙƒØ§Ù…Ù„Ø© + Ø­Ø§Ù„Ø§Øª</p>
            </div>
        </a>
        
        <!-- ØªØµØ¯ÙŠØ± Ø§Ù„ØªØ³Ù„ÙŠÙ…Ø§Øª -->
        <a href="{% url 'export_submissions_excel' %}" class="export-btn">
            <div class="export-icon">ğŸ“¤</div>
            <div class="export-info">
                <h4>ØªØµØ¯ÙŠØ± Ø§Ù„ØªØ³Ù„ÙŠÙ…Ø§Øª</h4>
                <p>ØªÙ‚ÙŠÙŠÙ…Ø§Øª + Ù…Ù„Ø§Ø­Ø¸Ø§Øª</p>
            </div>
        </a>
        
    </div>
</div>

<style>
.export-btn {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    border: 1px solid rgba(102, 126, 234, 0.3);
    border-radius: 15px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    text-decoration: none;
    transition: all 0.3s ease;
    cursor: pointer;
}

.export-btn:hover {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    border-color: rgba(102, 126, 234, 0.5);
}

.export-icon {
    font-size: 2.5rem;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 12px;
    flex-shrink: 0;
}

.export-info h4 {
    color: white;
    font-size: 1.1rem;
    margin: 0 0 5px 0;
    font-weight: 700;
}

.export-info p {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.85rem;
    margin: 0;
}
</style>


{% else %}
<!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ÙˆØ¸Ù -->

        
        <!-- Ù…Ø´Ø§Ø±ÙŠØ¹ÙŠ -->
        <section class="section" id="my-projects">
            <div class="section-header">
                <div class="section-title">
                    <div class="section-icon">ğŸ“</div>
                    <span>Ù…Ø´Ø§Ø±ÙŠØ¹ÙŠ</span>
                </div>
            </div>

            {% if projects %}
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th>
                            <th>Ø§Ù„Ù…Ø¯ÙŠØ±</th>
                            <th>Ù…Ù‡Ø§Ù…ÙŠ ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th>
                            <th>Ù†Ø³Ø¨Ø© Ø¥Ù†Ø¬Ø§Ø²ÙŠ</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for project in projects %}
                        <tr>
                            <td class="project-name">{{ project.name }}</td>
                            <td>
                                {% if project.manager %}
                                    {{ project.manager.first_name|default:project.manager.username }}
                                {% else %}
                                    <span style="color: rgba(255,255,255,0.4)">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>
                                {% endif %}
                            </td>
                            <td>{{ project.emp_task_count }} Ù…Ù‡Ø§Ù…</td>

                          <td>
                          <div class="progress-bar">
                          <div class="progress-fill" style="width: {{ project.emp_completion }}%">
                          </div>
                        </div>
                        <div class="progress-text">{{ project.emp_completion }}%</div>
                          </td>
                            <td>{{ project.end_date|date:"Y-m-d"|default:"â€”" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ“</div>
                <p>Ù„Ù… ÙŠØªÙ… ØªÙƒÙ„ÙŠÙÙƒ Ø¨Ø£ÙŠ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¨Ø¹Ø¯</p>
            </div>
            {% endif %}
        </section>

        <!-- Ù…Ù‡Ø§Ù…ÙŠ -->
<section class="section" id="my-tasks">
    <div class="section-header">
        <div class="section-title">
            <div class="section-icon">âœ…</div>
            <span>Ù…Ù‡Ø§Ù…ÙŠ</span>
        </div>
    </div>

    <!-- ÙÙ„Ø§ØªØ± Ø§Ù„Ø­Ø§Ù„Ø© + Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
    <form method="get" class="filters">
    <!-- ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„Ø© -->
    <div class="filter-group">
        <label class="filter-label">Ø§Ù„Ø­Ø§Ù„Ø©</label>
        <select name="status" class="filter-select" onchange="this.form.submit()">
            <option value="" {% if not selected_status %}selected{% endif %}>Ø§Ù„ÙƒÙ„</option>
            <option value="todo" {% if selected_status == 'todo' %}selected{% endif %}>To Do</option>
            <option value="in_progress" {% if selected_status == 'in_progress' %}selected{% endif %}>In Progress</option>
            <option value="under_review" {% if selected_status == 'under_review' %}selected{% endif %}>Under Review</option>
            <option value="completed" {% if selected_status == 'completed' %}selected{% endif %}>Completed</option>
            <option value="blocked" {% if selected_status == 'blocked' %}selected{% endif %}>Blocked</option>
            <option value="late" {% if selected_status == 'late' %}selected{% endif %}>Late</option>
        </select>
    </div>

    <!-- ÙÙ„ØªØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
    <div class="filter-group">
        <label class="filter-label">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
        <select name="project" class="filter-select" onchange="this.form.submit()">
            <option value="" {% if not selected_project %}selected{% endif %}>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</option>
            {% for project in projects %}
                <option value="{{ project.id }}"
                        {% if selected_project == project.id|stringformat:"s" %}selected{% endif %}>
                    {{ project.name }}
                </option>
            {% endfor %}
        </select>
    </div>
</form>



    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… -->
    {% if tasks %}
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Ø§Ù„Ù…Ù‡Ù…Ø©</th>
                    <th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                    <th>ÙˆØ²Ù† Ø§Ù„Ù…Ù‡Ù…Ø©</th>
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…</th>
                    <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody>
                {% for task in tasks %}
                <tr>
                    <td><strong>{{ task.title }}</strong></td>
                    <td>
                        {% if task.project %}
                            <span class="project-name">{{ task.project.name }}</span>
                        {% else %}
                            <span style="color: #fbbf24;">â­ Ù…Ù‡Ù…Ø© Ù…Ø³ØªÙ‚Ù„Ø©</span>
                        {% endif %}
                    </td>
                    <td>
                        <span class="status-badge status-{{ task.status }}">
                            {{ task.get_status_display }}
                        </span>
                    </td>
                    <td>
    {% if task.priority == 'high' %}
        <span class="status-badge" style="background: rgba(239, 68, 68, 0.2); color: #f87171;">
            Ø¹Ø§Ù„ÙŠØ© â­
        </span>
    {% elif task.priority == 'medium' %}
        <span class="status-badge" style="background: rgba(251, 191, 36, 0.2); color: #fbbf24;">
            Ù…ØªÙˆØ³Ø·Ø©
        </span>
    {% elif task.priority == 'low' %}
        <span class="status-badge" style="background: rgba(156, 163, 175, 0.2); color: #9ca3af;">
            Ù…Ù†Ø®ÙØ¶Ø©
        </span>
    {% else %}
        <span class="status-badge" style="background: rgba(156, 163, 175, 0.2); color: #9ca3af;">
            ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©
        </span>
    {% endif %}
</td>
                <td>
                    <div class="impact-cell">
                        <!-- âœ… Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙÙ‚Ø· -->
                        <span class="impact-label">
                            {{ task.get_impact_display }}
                        </span>
                    </div>
                </td>


                    <td>{{ task.due_date|date:"Y-m-d"|default:"â€”" }}</td>
                    <td>
                        <button class="btn btn-sm btn-edit" 
        onclick="openViewTaskModal(
            '{{ task.title|escapejs }}',
            '{% if task.project %}{{ task.project.name|escapejs }}{% else %}â­ Ù…Ù‡Ù…Ø© Ù…Ø³ØªÙ‚Ù„Ø©{% endif %}',
            '{{ task.due_date|date:'Y-m-d'|default:'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}',
            '{{ task.get_status_display }}',
            '{{ task.description|escapejs|default:'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ' }}',
            '{% url "start_task" task.id %}'
        )">
    ğŸ‘ï¸ Ø¹Ø±Ø¶
</button>




                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">âœ…</div>
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…ÙƒÙ„Ù Ø¨Ù‡Ø§ Ø­Ø§Ù„ÙŠØ§Ù‹</p>
    </div>
    {% endif %}
</section>


        <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ (Gantt Chart) -->
        <section class="section" id="timeline">
    <div class="section-header">
        <div class="section-title">
            <div class="section-icon">ğŸ“Š</div>
            <span>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ù‡Ø§Ù…ÙŠ</span>
        </div>
    </div>

    <div class="charts-grid">
        <!-- Tasks by Status -->
        <div class="chart-card">
        <h3 class="chart-title">Tasks by Status</h3>
        <canvas id="tasksStatusChart"></canvas>

        <!-- â¬…ï¸ Ù‡Ù†Ø§ Ø¨ÙŠØ·Ù„Ø¹ Ø§Ù„Ù„ÙŠØ¬Ù†Ø¯ Ø¨Ø´ÙƒÙ„ Ù…Ø±ØªØ¨ -->
        <div id="tasksStatusLegend" class="chartjs-legend"></div>
    </div>


        <!-- My Workload -->
        <div class="chart-card">
            <h3 class="chart-title">My Workload</h3>
            <div class="workload-wrapper">
                <canvas id="workloadChart"></canvas>
                <div class="workload-center">
                    <div class="workload-number">{{ workload|default:0 }}</div>
                    <div class="workload-total">/ {{ workload_capacity|default:10 }}</div>
                    <div class="workload-text">
                        {% if workload <= 5 %}
                            Workload is manageable
                        {% elif workload <= 8 %}
                            Workload is high
                        {% else %}
                            Workload is overloaded
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

        <!-- ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…Ù‡Ø§Ù… -->

        
<section class="section" id="submit-task">
    <div class="section-header">
        <div class="section-title">
            <div class="section-icon">ğŸ“¤</div>
            <span>ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…Ù‡Ø§Ù…</span>
        </div>
    </div>

    <div class="submit-form">
        <form method="post" action="{% url 'submit_task' %}" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‡Ù…Ø© -->
    <div class="form-group">
        <label class="form-label">* Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‡Ù…Ø©</label>
        <select name="task_id" class="form-input">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‡Ù…Ø© *</option>
    {% for task in submit_tasks %}
        <option value="{{ task.id }}">{{ task.title }}</option>
    {% endfor %}
</select>


    </div>

    <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… -->
    <div class="form-group">
        <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… *</label>
        <textarea name="notes" class="form-textarea"
                  placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø­ÙˆÙ„ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ù…Ù†Ø¬Ø²Ø©..."></textarea>
    </div>

            <div class="form-group">
                <label class="form-label">Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª</label>
                <div class="file-upload" id="fileUploadArea">
    <div class="file-upload-icon">ğŸ“</div>
    <p style="color: rgba(255,255,255,0.7); margin-bottom: 5px;">
        Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±
    </p>
    <p style="color: rgba(255,255,255,0.5); font-size: 0.9rem;">
        (Ø­ØªÙ‰ 10MB) PDF, DOC, DOCX, PNG, JPG
    </p>

    <!-- Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ØªØ§Ø± -->
    <span class="file-name" id="fileName"
          style="display:block; margin-top:10px; color:rgba(255,255,255,0.8); font-size:0.9rem;">
        Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø¨Ø¹Ø¯
    </span>

    <!-- Ø­Ù‚Ù„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ÙÙŠ -->
    <input id="attachmentInput"
           type="file"
           name="attachment"
           accept=".pdf,.doc,.docx,.png,.jpg,.jpeg"
           style="display:none;">
</div>

            </div>

            <button type="submit" class="btn btn-submit">
                <span>ğŸ“¤</span>
                <span>ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…Ù‡Ù…Ø©</span>
            </button>
        </form>
    </div>
</section>


        {% endif %}

<!-- Modal ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
<div id="editProjectModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h2>
            <span class="modal-close" onclick="closeEditModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="editProjectForm" method="post">
                {% csrf_token %}
                
                <div class="modal-form-group">
                    <label for="edit_name">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ *</label>
                    <input type="text" id="edit_name" name="name" class="modal-input" required>
                </div>

                <div class="modal-form-group">
                    <label for="edit_description">Ø§Ù„ÙˆØµÙ</label>
                    <textarea id="edit_description" name="description" class="modal-textarea" rows="4"></textarea>
                </div>

                <div class="modal-form-row">
                    <div class="modal-form-group">
                        <label for="edit_start_date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                        <input type="date" id="edit_start_date" name="start_date" class="modal-input">
                    </div>

                    <div class="modal-form-group">
                        <label for="edit_end_date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</label>
                        <input type="date" id="edit_end_date" name="end_date" class="modal-input">
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-modal-cancel" onclick="closeEditModal()">Ø¥Ù„ØºØ§Ø¡</button>
                    <button type="submit" class="btn-modal-save">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
<div id="deleteProjectModal" class="modal">
    <div class="modal-content delete-modal">
        <div class="modal-header delete-header">
            <h2>âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h2>
            <span class="modal-close" onclick="closeDeleteModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div class="warning-icon">ğŸ—‘ï¸</div>
            <h3 style="color: #2d3748; margin: 20px 0; font-size: 1.5rem;">
                Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŸ
            </h3>
            <p style="color: #718096; font-size: 1.1rem; margin-bottom: 10px;">
                Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: <strong id="delete_project_name" style="color: #ef4444;"></strong>
            </p>
            
            <div class="warning-box">
                <p>âš ï¸ ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹!</p>
                <p style="margin-top: 10px;">Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.</p>
            </div>

            <form id="deleteProjectForm" method="post">
                {% csrf_token %}
                <div class="modal-actions">
                    <button type="button" class="btn-modal-cancel" onclick="closeDeleteModal()">
                        â†©ï¸ Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" class="btn-modal-delete">
                        ğŸ—‘ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø© (Ù„Ù„Ù…ÙˆØ¸Ù) -->
<div id="viewTaskModal" class="modal">
    <div class="modal-content task-details-modal">
        <div class="modal-header task-header">
            <h2>ğŸ‘ï¸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©</h2>
            <span class="modal-close" onclick="closeViewTaskModal()">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø© -->
            <div class="task-detail-row">
                <div class="detail-icon">ğŸ“</div>
                <div class="detail-content">
                    <h4 class="detail-label">Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</h4>
                    <p id="view_task_title" class="detail-value"></p>
                </div>
            </div>

            <!-- Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
            <div class="task-detail-row">
                <div class="detail-icon">ğŸ“</div>
                <div class="detail-content">
                    <h4 class="detail-label">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h4>
                    <p id="view_task_project" class="detail-value"></p>
                </div>
            </div>

            <!-- ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ… -->
            <div class="task-detail-row">
                <div class="detail-icon">ğŸ“…</div>
                <div class="detail-content">
                    <h4 class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</h4>
                    <p id="view_task_due_date" class="detail-value"></p>
                </div>
            </div>

            <!-- Ø§Ù„Ø­Ø§Ù„Ø© -->
            <div class="task-detail-row">
                <div class="detail-icon">âœ…</div>
                <div class="detail-content">
                    <h4 class="detail-label">Ø§Ù„Ø­Ø§Ù„Ø©</h4>
                    <p id="view_task_status" class="detail-value"></p>
                </div>
            </div>

            <!-- Ø§Ù„ÙˆØµÙ -->
            <div class="task-detail-row description-row">
                <div class="detail-icon">ğŸ“‹</div>
                <div class="detail-content">
                    <h4 class="detail-label">Ø§Ù„ÙˆØµÙ</h4>
                    <div id="view_task_description" class="detail-description"></div>
                </div>
            </div>

            <!-- Ø£Ø²Ø±Ø§Ø± Ø£Ø³ÙÙ„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ -->
<div class="modal-actions">
    <!-- Ø²Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© (Ù†Ø®Ù„ÙŠÙ‡ Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹) -->
    <button type="button"
            id="startTaskBtn"
            class="btn-modal-save"
            style="display: none;">
        ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©
    </button>

    <!-- Ø²Ø± ÙÙ‡Ù…Øª (Ø¯Ø§ÙŠÙ… Ø¸Ø§Ù‡Ø±) -->
    <button type="button"
            class="btn-modal-cancel"
            onclick="closeViewTaskModal()">
        âœ… ÙÙ‡Ù…Øª
    </button>
</div>


    <!-- ÙÙˆØ±Ù… Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© (ÙŠÙØ¹Ø¯Ù‘ÙÙ„ Ø§Ù„Ù€ action Ù…Ù† Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª) -->
    <form id="startTaskForm" method="post" style="flex:2; margin:0; text-align:left;">
        {% csrf_token %}
        <button type="submit"
                id="startTaskBtn"
                class="btn-modal-save"
                style="display:none; background: linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);">
            ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©
        </button>
    </form>
</div>

            </div>
        </div>
    </div>
</div>

<!-- Modal Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ -->
<div id="addProjectModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</h2>
            <span class="modal-close" onclick="closeAddProjectModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form method="post" action="{% url 'create_project' %}"> 
                {% csrf_token %}
                
                <!-- Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
                <div class="modal-form-group">
                    <label for="project_name">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ *</label>
                    <input type="text" id="project_name" name="name" 
                           class="modal-input" 
                           placeholder="Ù…Ø«Ø§Ù„: ØªØ·ÙˆÙŠØ± ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¬ÙˆØ§Ù„" 
                           required>
                </div>

                <!-- ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
                <div class="modal-form-group">
                    <label for="project_description">ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                    <textarea id="project_description" name="description" 
                              class="modal-textarea" 
                              rows="4" 
                              placeholder="Ø£Ø¯Ø®Ù„ ÙˆØµÙØ§Ù‹ ØªÙØµÙŠÙ„ÙŠØ§Ù‹ Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŒ Ø£Ù‡Ø¯Ø§ÙÙ‡ØŒ ÙˆÙ†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ù…Ù„..."></textarea>
                    <span class="field-help">ÙˆØµÙ Ù…Ø®ØªØµØ± ÙŠÙˆØ¶Ø­ ØªÙØ§ØµÙŠÙ„ ÙˆØ£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</span>
                </div>

                <!-- ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© -->
                <div class="modal-form-row">
                    <div class="modal-form-group">
                        <label for="project_start_date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                        <input type="date" id="project_start_date" name="start_date" class="modal-input">
                    </div>

                    <div class="modal-form-group">
                        <label for="project_end_date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</label>
                        <input type="date" id="project_end_date" name="end_date" class="modal-input">
                    </div>
                </div>

                <!-- Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
                <div class="modal-form-group">
                    <label for="project_manager">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                    <select id="project_manager" name="manager" class="modal-input">
                        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠØ± --</option>
                        <option value="{{ request.user.id }}" selected>
                            {{ request.user.first_name|default:request.user.username }} (Ø£Ù†Øª)
                        </option>
                        <!-- ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø±Ø§Ø¡ Ø¢Ø®Ø±ÙŠÙ† Ù‡Ù†Ø§ Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ† -->
                    </select>
                    <span class="field-help">Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹: Ø£Ù†Øª)</span>
                </div>

                <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
                <div class="modal-actions">
                    <button type="button" class="btn-modal-cancel" onclick="closeAddProjectModal()">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" class="btn-modal-save">
                        â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© -->
<div class="modal-overlay-task" id="addTaskModalNew">
    <div class="modal-box-task">
        <!-- Header -->
        <div class="modal-header-task">
            <h2>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <button class="close-btn-task" onclick="closeTaskModal()">Ã—</button>
        </div>

        <!-- Body -->
        <div class="modal-body-task">
            <form method="post" action="{% url 'create_task' %}">
                {% csrf_token %}
                
                <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
                <div class="field-task">
                    <label class="label-task">
                        Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø© <span class="required-star">*</span>
                    </label>
                    <input type="text" 
                           name="title" 
                           class="input-task" 
                           placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©" 
                           required>
                </div>

                <!-- Ø§Ù„ÙˆØµÙ -->
                <div class="field-task">
                    <label class="label-task">Ø§Ù„ÙˆØµÙ</label>
                    <textarea name="description" 
                              class="textarea-task" 
                              placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ù…Ù‡Ù…Ø©..."></textarea>
                </div>

                <!-- Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
                <div class="field-task">
                    <label class="label-task">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                    <select name="project" class="select-task">
                        <option value="">-- Ù…Ù‡Ù…Ø© Ù…Ø³ØªÙ‚Ù„Ø© (Ø¨Ø¯ÙˆÙ† Ù…Ø´Ø±ÙˆØ¹) --</option>
                        {% for project in projects %}
                            <option value="{{ project.id }}">{{ project.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <!-- Ø­Ø§ÙˆÙŠØ© ÙÙŠÙ‡Ø§ Ø­Ù‚Ù„ÙŠÙ† ØµØºÙŠØ±ÙŠÙ† Ø¬Ù†Ø¨ Ø¨Ø¹Ø¶ -->
<div style="display: flex; gap: 10px; margin-top: 10px;">

    <!-- Ø­Ù‚Ù„ Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù…Ù‡Ù…Ø© -->
    <div class="field-task" style="flex: 1;">
        <label class="label-task">Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù…Ù‡Ù…Ø©</label>
        <select
            name="priority"
            id="taskPriority"
            class="select-task"
        >
            <option value="high">Ø¹Ø§Ù„ÙŠØ©</option>
            <option value="medium" selected>Ù…ØªÙˆØ³Ø·Ø©</option>
            <option value="low">Ù…Ù†Ø®ÙØ¶Ø©</option>
        </select>
    </div>

    <!-- Ø­Ù‚Ù„ ÙˆØ²Ù† Ø§Ù„Ù…Ù‡Ù…Ø© (ØªØ£Ø«ÙŠØ± Ø§Ù„Ø­Ù…Ù„) -->
    <div class="field-task" style="flex: 1;">
        <label class="label-task">ÙˆØ²Ù† Ø§Ù„Ù…Ù‡Ù…Ø© (ØªØ£Ø«ÙŠØ± Ø§Ù„Ø­Ù…Ù„)</label>
        <select
            name="impact"
            id="taskImpact"
            class="select-task"
        >
            <option value="normal">Ø®ÙÙŠÙØ© (1 Ù†Ù‚Ø·Ø©)</option>
            <option value="medium" selected>Ù…ØªÙˆØ³Ø·Ø© (2 Ù†Ù‚Ø·Ø©)</option>
            <option value="heavy">Ø«Ù‚ÙŠÙ„Ø© (3 Ù†Ù‚Ø§Ø·)</option>
        </select>
    </div>
</div>


                <!-- Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ -->
                <div class="field-task">
                    <label class="label-task">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</label>
                    <input type="date" 
                           name="due_date" 
                           class="input-task" 
                           id="taskDueDate">
                </div>

                <!-- Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© -->
                <div class="field-task">
                    <label class="skills-label-task">Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
                    <div class="skills-box-task">
                        {% for skill in skills %}
                            <span class="chip-task" 
                                  data-skill-id="{{ skill.id }}" 
                                  onclick="toggleSkill(this)">
                                {{ skill.name }}
                            </span>
                        {% endfor %}
                    </div>
                    <!-- Hidden inputs -->
                    <div id="skillsHiddenInputs"></div>
                </div>

                <!-- ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ÙˆØ¸Ù -->
                <div class="field-task">
                    <label class="label-task">ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ÙˆØ¸Ù</label>
                    <div class="assign-row-task">
                        <select name="assignee" class="select-task" id="employeeSelect">
                            <option value="">-- Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ† --</option>
                            {% for emp in employees %}
                                <option value="{{ emp.id }}">{{ emp.first_name|default:emp.username }}</option>
                            {% endfor %}
                        </select>

                        <button type="button" 
                                class="smart-btn-task" 
                                id="smartBtn" 
                                onclick="toggleSmartAssign()">
                            âš¡ Ø¥Ø³Ù†Ø§Ø¯ Ø°ÙƒÙŠ
                        </button>
                    </div>

                    <div class="suggestion-card-task" id="suggestionCard">
                        <div id="loadingState" class="loading-task">
                            <div class="spinner-task"></div>
                            <p style="margin-top: 8px; font-size: 0.875rem;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...</p>
                        </div>

                        <div id="resultState" style="display: none;">
                            <span class="suggestion-badge-task">â­ Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ù‚ØªØ±Ø­</span>
                            
                            <div class="employee-card-task">
                                <div class="avatar-task" id="empAvatar">ğŸ‘¨â€ğŸ’»</div>
                                <div class="emp-details-task">
                                    <div class="emp-name-task" id="empName">Ù…ÙˆØ¸Ù</div>
                                    <div class="emp-role-task" id="empRole">Ø§Ù„ØªØ®ØµØµ</div>
                                </div>
                            
                            </div>

                            <div class="reasons-box-task">
                                <p>Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±:</p>
                                <ul id="reasonsList"></ul>
                            </div>
                        </div>
                    </div>

                    <input type="hidden" name="auto_assignee" id="autoAssignee">
                    <input type="hidden" name="assignment_type" id="assignmentType" value="manual">
                </div>

                <input type="hidden" name="status" value="todo">

                <button type="submit" class="submit-btn-task">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©</button>
            </form>
        </div>
    </div>
</div>



<!-- Modal ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø© -->
<div id="editTaskModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©</h2>
            <span class="modal-close" onclick="closeEditTaskModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="editTaskForm" method="post">
                {% csrf_token %}
                
                <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø© -->
                <div class="modal-form-group">
                    <label for="edit_task_title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø© *</label>
                    <input type="text" id="edit_task_title" name="title" class="modal-input" required>
                </div>

                <!-- ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø© -->
                <div class="modal-form-group">
                    <label for="edit_task_description">Ø§Ù„ÙˆØµÙ</label>
                    <textarea id="edit_task_description" name="description" class="modal-textarea" rows="4"></textarea>
                </div>

                <!-- Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
                <div class="modal-form-group">
                    <label for="edit_task_project">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                    <select id="edit_task_project" name="project" class="modal-input">
                        <option value="">-- Ù…Ù‡Ù…Ø© Ù…Ø³ØªÙ‚Ù„Ø© (Ø¨Ø¯ÙˆÙ† Ù…Ø´Ø±ÙˆØ¹) --</option>
                        {% for project in projects %}
                            <option value="{{ project.id }}">{{ project.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ -->
                <div class="modal-form-group">
                    <label for="edit_task_assignee">Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ù€</label>
                    <select id="edit_task_assignee" name="assignee" class="modal-input">
                        <option value="">-- Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ† --</option>
                        {% for user in employees %}
                            <option value="{{ user.id }}">
                                {{ user.first_name|default:user.username }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© -->
                <div class="modal-form-row">
                    <div class="modal-form-group">
                        <label for="edit_task_status">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                        <select id="edit_task_status" name="status" class="modal-input">
                            <option value="todo">â³ To Do</option>
                            <option value="in_progress">ğŸ”„ In Progress</option>
                            <option value="completed">âœ… Completed</option>
                            <option value="blocked">ğŸš« Blocked</option>
                        </select>
                    </div>

                    <div class="modal-form-group">
                        <label for="edit_task_due_date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</label>
                        <input type="date" id="edit_task_due_date" name="due_date" class="modal-input">
                    </div>
                </div>

                <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
                <div class="modal-actions">
                    <button type="button" class="btn-modal-cancel" onclick="closeEditTaskModal()">Ø¥Ù„ØºØ§Ø¡</button>
                    <button type="submit" class="btn-modal-save">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø© -->
<div id="deleteTaskModal" class="modal">
    <div class="modal-content delete-modal">
        <div class="modal-header delete-header">
            <h2>âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h2>
            <span class="modal-close" onclick="closeDeleteTaskModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div class="warning-icon">ğŸ—‘ï¸</div>
            <h3 style="color: #2d3748; margin: 20px 0; font-size: 1.5rem;">
                Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ
            </h3>
            <p style="color: #718096; font-size: 1.1rem; margin-bottom: 10px;">
                Ø§Ù„Ù…Ù‡Ù…Ø©: <strong id="delete_task_name" style="color: #ef4444;"></strong>
            </p>
            
            <div class="warning-box">
                <p>âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!</p>
            </div>

            <form id="deleteTaskForm" method="post">
                {% csrf_token %}
                <div class="modal-actions">
                    <button type="button" class="btn-modal-cancel" onclick="closeDeleteTaskModal()">
                        â†©ï¸ Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" class="btn-modal-delete">
                        ğŸ—‘ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>


    </main>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø¬ÙˆÙ…
        function createStars() {
            const container = document.getElementById('starsBackground');
            const starCount = 100;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                container.appendChild(star);
            }
        }

        window.addEventListener('load', createStars);

        // Smooth Scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Active Sidebar Link
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', function() {
                document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Tab Switching
        function showTab(tabId) {
            // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© active Ù…Ù† ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ø¯Ø¯
            const selectedTab = document.getElementById(tabId);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø¶ØºÙˆØ·
            event.target.classList.add('active');
        }

    // ÙØªØ­ Modal Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
function openEditModal(projectId, name, description, startDate, endDate) {
    // Ø¹Ø±Ø¶ Ø§Ù„Ù€ Modal
    document.getElementById('editProjectModal').style.display = 'block';
    
    // Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    document.getElementById('edit_name').value = name;
    document.getElementById('edit_description').value = description;
    document.getElementById('edit_start_date').value = startDate;
    document.getElementById('edit_end_date').value = endDate;
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù€ action Ù„Ù„Ù€ form
    const form = document.getElementById('editProjectForm');
    form.action = `/projects/${projectId}/edit/`;
}

// Ø¥ØºÙ„Ø§Ù‚ Modal
function closeEditModal() {
    document.getElementById('editProjectModal').style.display = 'none';
}

// Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø§Ù„Ù€ Modal
window.onclick = function(event) {
    const modal = document.getElementById('editProjectModal');
    if (event.target == modal) {
        closeEditModal();
    }
}

// ÙØªØ­ Modal ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù
function openDeleteModal(projectId, projectName) {
    // Ø¹Ø±Ø¶ Ø§Ù„Ù€ Modal
    document.getElementById('deleteProjectModal').style.display = 'block';
    
    // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
    document.getElementById('delete_project_name').textContent = projectName;
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù€ action Ù„Ù„Ù€ form
    const form = document.getElementById('deleteProjectForm');
    form.action = `/projects/${projectId}/delete/`;
}

// Ø¥ØºÙ„Ø§Ù‚ Modal Ø§Ù„Ø­Ø°Ù
function closeDeleteModal() {
    document.getElementById('deleteProjectModal').style.display = 'none';
}

// ØªØ­Ø¯ÙŠØ«: Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø£ÙŠ Modal
window.onclick = function(event) {
    const editModal = document.getElementById('editProjectModal');
    const deleteModal = document.getElementById('deleteProjectModal');
    
    if (event.target == editModal) {
        closeEditModal();
    }
    if (event.target == deleteModal) {
        closeDeleteModal();
    }
}
// ğŸŸ£ Drag & Drop Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª + Ø¥Ø¸Ù‡Ø§Ø± Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù
const fileUploadArea = document.getElementById('fileUploadArea');
const fileInput = document.getElementById('attachmentInput');
const fileNameSpan = document.getElementById('fileName');

if (fileUploadArea && fileInput && fileNameSpan) {
    // ÙØªØ­ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù Ø¨Ø§Ù„Ø¶ØºØ·
    fileUploadArea.addEventListener('click', function () {
        fileInput.click();
    });

    // Ù„Ù…Ø§ ÙŠØ®ØªØ§Ø± Ù…Ù„Ù Ù…Ù† Ø§Ù„Ù€ dialog
    fileInput.addEventListener('change', function () {
        if (fileInput.files && fileInput.files.length > 0) {
            fileNameSpan.textContent = fileInput.files[0].name;
        } else {
            fileNameSpan.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø¨Ø¹Ø¯';
        }
    });

    // Ù…Ù†Ø¹ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù€ drag
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        fileUploadArea.addEventListener(eventName, function (e) {
            e.preventDefault();
            e.stopPropagation();
        });
    });

    // Ù„Ù…Ø§ ÙŠØ¯Ø®Ù„ Ù…Ù„Ù ÙÙˆÙ‚ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
    ['dragenter', 'dragover'].forEach(eventName => {
        fileUploadArea.addEventListener(eventName, function () {
            fileUploadArea.classList.add('drag-over');
        });
    });

    // Ù„Ù…Ø§ ÙŠØ·Ù„Ø¹ Ø£Ùˆ ÙŠÙ†Ø²Ù„ Ø§Ù„Ù…Ù„Ù
    ['dragleave', 'drop'].forEach(eventName => {
        fileUploadArea.addEventListener(eventName, function () {
            fileUploadArea.classList.remove('drag-over');
        });
    });

    // Ø¹Ù†Ø¯ Ø§Ù„Ø¥ÙÙ„Ø§Øª
    fileUploadArea.addEventListener('drop', function (e) {
        const files = e.dataTransfer.files;
        if (files && files.length > 0) {
            fileInput.files = files;
            fileNameSpan.textContent = files[0].name;
        }
    });
}

// ÙØªØ­ Modal Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©
function openViewTaskModal(title, project, dueDate, status, description, startUrl) {
    // Ø¹Ø±Ø¶ Ø§Ù„Ù€ Modal
    document.getElementById('viewTaskModal').style.display = 'block';
    
    // Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    document.getElementById('view_task_title').textContent = title;
    document.getElementById('view_task_project').textContent = project;
    document.getElementById('view_task_due_date').textContent = dueDate;
    document.getElementById('view_task_status').innerHTML = getStatusBadge(status);
    document.getElementById('view_task_description').textContent = description;

    // ğŸ”¹ Ø²Ø± "Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©"
    const startBtn = document.getElementById('startTaskBtn');

    if (startBtn) {
        if (status === 'To Do') {
            // Ø£Ø¸Ù‡Ø± Ø§Ù„Ø²Ø± ÙˆØ®Ù„Ù‘Ù Ø§Ù„Ø¶ØºØ· ÙŠØ±ÙˆØ­ Ù„Ø±Ø§Ø¨Ø· Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©
            startBtn.style.display = 'inline-flex';
            startBtn.onclick = function() {
                window.location.href = startUrl;   // ÙŠØ±ÙˆØ­ Ù„Ù„Ù€ view Ø§Ù„Ù„ÙŠ ÙƒØªØ¨Ù†Ø§Ù‡
            };
        } else {
            // Ø£ÙŠ Ø­Ø§Ù„Ø© Ø«Ø§Ù†ÙŠØ© â†’ Ø®Ø¨Ù‘ÙŠ Ø§Ù„Ø²Ø± ÙˆØ§Ù…Ø³Ø­ Ø§Ù„Ù€ onclick
            startBtn.style.display = 'none';
            startBtn.onclick = null;
        }
    }
}



// Ø¥ØºÙ„Ø§Ù‚ Modal Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‡Ù…Ø©
function closeViewTaskModal() {
    document.getElementById('viewTaskModal').style.display = 'none';
}

// Helper function Ù„Ø¥Ù†Ø´Ø§Ø¡ badge Ø§Ù„Ø­Ø§Ù„Ø©
function getStatusBadge(status) {
    const badges = {
        'To Do': '<span style="background: rgba(156, 163, 175, 0.2); color: #9ca3af; padding: 6px 15px; border-radius: 20px; font-weight: 600;">â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</span>',
        'In Progress': '<span style="background: rgba(59, 130, 246, 0.2); color: #3b82f6; padding: 6px 15px; border-radius: 20px; font-weight: 600;">ğŸ”„ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</span>',
        'Completed': '<span style="background: rgba(34, 197, 94, 0.2); color: #22c55e; padding: 6px 15px; border-radius: 20px; font-weight: 600;">âœ… Ù…ÙƒØªÙ…Ù„Ø©</span>',
        'Blocked': '<span style="background: rgba(239, 68, 68, 0.2); color: #ef4444; padding: 6px 15px; border-radius: 20px; font-weight: 600;">ğŸš« Ù…Ø¹Ù„Ù‚Ø©</span>'
    };
    return badges[status] || status;
}

// ØªØ­Ø¯ÙŠØ«: Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø£ÙŠ Modal
window.onclick = function(event) {
    const editModal = document.getElementById('editProjectModal');
    const deleteModal = document.getElementById('deleteProjectModal');
    const viewTaskModal = document.getElementById('viewTaskModal');
    
    if (event.target == editModal) {
        closeEditModal();
    }
    if (event.target == deleteModal) {
        closeDeleteModal();
    }
    if (event.target == viewTaskModal) {
        closeViewTaskModal();
    }
}
// ÙØªØ­ Modal Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹
function openAddProjectModal() {
    document.getElementById('addProjectModal').style.display = 'block';
    
    // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ÙƒØ­Ø¯ Ø£Ø¯Ù†Ù‰
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('project_start_date').min = today;
    document.getElementById('project_end_date').min = today;
}

// Ø¥ØºÙ„Ø§Ù‚ Modal Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹
function closeAddProjectModal() {
    document.getElementById('addProjectModal').style.display = 'none';
    // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
    document.getElementById('project_name').value = '';
    document.getElementById('project_description').value = '';
    document.getElementById('project_start_date').value = '';
    document.getElementById('project_end_date').value = '';
}

// Validation: ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
document.getElementById('project_start_date')?.addEventListener('change', function() {
    const endDateInput = document.getElementById('project_end_date');
    endDateInput.min = this.value;
});

// ØªØ­Ø¯ÙŠØ«: Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø£ÙŠ Modal
window.onclick = function(event) {
    const editModal = document.getElementById('editProjectModal');
    const deleteModal = document.getElementById('deleteProjectModal');
    const viewTaskModal = document.getElementById('viewTaskModal');
    const addProjectModal = document.getElementById('addProjectModal');
    
    if (event.target == editModal) {
        closeEditModal();
    }
    if (event.target == deleteModal) {
        closeDeleteModal();
    }
    if (event.target == viewTaskModal) {
        closeViewTaskModal();
    }
    if (event.target == addProjectModal) {
        closeAddProjectModal();
    }
}
// ÙØªØ­ Modal Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
// ÙØªØ­ Modal
function openTaskModal() {
    document.getElementById('addTaskModalNew').classList.add('show');
    
    // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ÙƒØ­Ø¯ Ø£Ø¯Ù†Ù‰
    const today = new Date().toISOString().split('T')[0];
    const dateInput = document.getElementById('taskDueDate');
    if (dateInput) {
        dateInput.min = today;
    }
}

// Ø¥ØºÙ„Ø§Ù‚ Modal
function closeTaskModal() {
    const modal = document.getElementById('addTaskModalNew');
    modal.classList.remove('show');
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    const form = modal.querySelector('form');
    if (form) form.reset();
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª
    document.querySelectorAll('.chip-task.active').forEach(chip => {
        chip.classList.remove('active');
    });
    
    // Ù…Ø³Ø­ hidden inputs
    document.getElementById('skillsHiddenInputs').innerHTML = '';
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ø°ÙƒÙŠ
    document.getElementById('suggestionCard').classList.remove('show');
    document.getElementById('smartBtn').classList.remove('active');
    document.getElementById('employeeSelect').disabled = false;
    isSmartActive = false;
}

// Ø§Ø®ØªÙŠØ§Ø±/Ø¥Ù„ØºØ§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‡Ø§Ø±Ø©
function toggleSkill(element) {
    element.classList.toggle('active');
    updateSkillsInputs();
}

// ØªØ­Ø¯ÙŠØ« hidden inputs Ù„Ù„Ù…Ù‡Ø§Ø±Ø§Øª
function updateSkillsInputs() {
    const container = document.getElementById('skillsHiddenInputs');
    container.innerHTML = '';
    
    const selected = document.querySelectorAll('.chip-task.active');
    selected.forEach(chip => {
        const skillId = chip.getAttribute('data-skill-id');
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'required_skills';
        input.value = skillId;
        container.appendChild(input);
    });
}

// Ù…ØªØºÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ø°ÙƒÙŠ
const SMART_ASSIGN_URL = "{% url 'smart_assign_api' %}";
// Ù…ØªØºÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ø°ÙƒÙŠ (Ø¨Ø³ Ø¹Ø´Ø§Ù† Ù†Ø¹Ø±Ù Ù‡Ù„ Ø§Ù„ÙƒØ±Øª Ø¸Ø§Ù‡Ø± ÙˆÙ„Ø§ Ù„Ø§)
let isSmartActive = false;

async function toggleSmartAssign() {
    const btn       = document.getElementById('smartBtn');
    const card      = document.getElementById('suggestionCard');
    const select    = document.getElementById('employeeSelect');
    const loading   = document.getElementById('loadingState');
    const result    = document.getElementById('resultState');
    const typeInput = document.getElementById('assignmentType');
    const autoInput = document.getElementById('autoAssignee');

    // Ù„Ùˆ Ø§Ù„ÙƒØ±Øª Ø¸Ø§Ù‡Ø± Ùˆ Ø¶ØºØ·Ù†Ø§ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ© â†’ Ù†Ø®ÙÙŠÙ‡ ÙˆÙ†Ø±Ø¬Ø¹ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
    if (isSmartActive) {
        isSmartActive = false;
        btn.classList.remove('active');
        card.classList.remove('show');
        typeInput.value = 'manual';
        autoInput.value = '';
        // Ù†ØªØ±Ùƒ Ø§Ù„Ù€ select Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ (Ø¹Ø´Ø§Ù† Ù„Ùˆ Ø§Ù„Ù…Ø¯ÙŠØ± Ø¹Ø¯Ù‘Ù„ ÙŠØ¯Ù‡)
        return;
    }

    // ---- 1) Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙˆØ±Ù… ----
    const titleInput       = document.querySelector('input[name="title"]');
    const descInput        = document.querySelector('textarea[name="description"]');
    const dueDateInput     = document.querySelector('input[name="due_date"]');
    const selectedSkillEls = document.querySelectorAll('.chip-task.active');

    const title       = titleInput ? titleInput.value.trim() : '';
    const description = descInput ? descInput.value.trim() : '';
    const dueDate     = dueDateInput && dueDateInput.value ? dueDateInput.value : null;
    const priority = document.getElementById('taskPriority').value; 
    const impact   = document.getElementById('taskImpact').value;   

    if (!title && !description) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ ÙˆØµÙ Ù„Ù„Ù…Ù‡Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹');
        return;
    }

    if (selectedSkillEls.length === 0) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø£ÙˆÙ„Ø§Ù‹');
        return;
    }

    const requiredSkillIds = Array.from(selectedSkillEls).map(el =>
        parseInt(el.getAttribute('data-skill-id'))
    );

    // ---- 2) ØªØ¬Ù‡ÙŠØ² ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ----
    isSmartActive = true;
    btn.classList.add('active');
    card.classList.add('show');
    loading.style.display = 'block';
    result.style.display  = 'none';
    typeInput.value = 'auto';
    autoInput.value = '';

    // ---- 3) ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù€ payload ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù€ API ----
    const payload = {
        title: title,
        description: description,
        due_date: dueDate,            
        required_skills: requiredSkillIds,
        priority: priority,          
        impact: impact 

    };

    try {
        const response = await fetch(SMART_ASSIGN_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                // csrf ØºÙŠØ± Ø¶Ø±ÙˆØ±ÙŠ Ø­Ø§Ù„ÙŠØ§Ù‹ Ù„Ø£Ù† view Ø¹Ù„ÙŠÙ‡Ø§ csrf_exempt
            },
            body: JSON.stringify(payload)
        });

        const data = await response.json();

        if (!response.ok || !data.ok) {
            console.error('Smart assign error:', data);
            alert(data.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ø°ÙƒÙŠ');
            // Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            isSmartActive = false;
            btn.classList.remove('active');
            card.classList.remove('show');
            typeInput.value = 'manual';
            return;
        }

        const suggested = data.suggested_user;
        const reason    = data.reason || '';
        const scores    = data.scores || [];

        if (!suggested) {
            alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…ÙˆØ¸Ù Ù…Ù†Ø§Ø³Ø¨ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø©');
            isSmartActive = false;
            btn.classList.remove('active');
            card.classList.remove('show');
            typeInput.value = 'manual';
            return;
        }

        // ---- 4) ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© ----
        loading.style.display = 'none';
        result.style.display  = 'block';

        // Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù + Ø§Ù„ØªØ®ØµØµ
        document.getElementById('empName').textContent = suggested.name || 'Ù…ÙˆØ¸Ù';
        document.getElementById('empRole').textContent = suggested.job_role || 'â€”';

        // Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ·Ø§Ø¨Ù‚ Ù…Ù† scores
        let scoreForUser = scores.find(s => s.user_id === suggested.id);
        let percent = 0;
        if (scoreForUser && typeof scoreForUser.score === 'number') {
            percent = Math.round(scoreForUser.score * 100);
        }
        

        const reasonsList = document.getElementById('reasonsList');
        reasonsList.innerHTML = '';

        let text = (reason || '').trim();

        // Ù†Ù‚Ø³Ù… Ø¹Ù„Ù‰ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ Ø£Ùˆ Ø´Ø±Ø·Ø© Ø£Ùˆ Ù†Ù‚Ø·Ø©
        let parts = text.split(/[\n\-â€¢]+/).map(p => p.trim()).filter(p => p.length > 0);

        // Ù„Ùˆ Ù…Ø§ Ø±Ø¬Ø¹ Ø´ÙŠØ¡ Ø³Ù„ÙŠÙ…ØŒ Ù†Ø­Ø· Ø³Ø¨Ø¨ Ø§ÙØªØ±Ø§Ø¶ÙŠ
        if (parts.length === 0) {
            parts = ['ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªÙˆØ§ÙÙ‚ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª ÙˆØ¹Ø¨Ø¡ Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù….'];
        }

        parts.forEach(p => {
            const li = document.createElement('li');
            li.textContent = p;
            reasonsList.appendChild(li);
        });


        // Ù†Ø®Ù„ÙŠ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ ÙØ¹Ù„ÙŠ: Ù†Ø®ØªØ§Ø± Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ù‚ØªØ±Ø­ ÙÙŠ Ø§Ù„Ù€ select
        select.disabled = false;     // Ù†Ø®Ù„ÙŠÙ‡ Ù…ØªØ§Ø­ Ø¹Ø´Ø§Ù† Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠÙ‚Ø¯Ø± ÙŠØºÙŠÙ‘Ø± Ù„Ùˆ Ø­Ø§Ø¨
        select.value    = String(suggested.id);

        // Ù†Ø®Ø²Ù† Ø§Ù„Ù€ id ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø®ÙÙŠ (Ù„Ùˆ Ø­Ø§Ø¨ ØªØ³ØªØ®Ø¯Ù…Ù‡ ÙÙŠ Ø§Ù„Ù€ View)
        autoInput.value = suggested.id;

    } catch (err) {
        console.error(err);
        alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø¯Ù…Ø© Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ø°ÙƒÙŠ');
        isSmartActive = false;
        btn.classList.remove('active');
        card.classList.remove('show');
        typeInput.value = 'manual';
        autoInput.value = '';
    }
}


// Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Modal
document.getElementById('addTaskModalNew')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closeTaskModal();
    }
});
// ========== ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø© ==========

// ÙØªØ­ Modal ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©
function openEditTaskModal(taskId, title, description, projectId, assigneeId, status, dueDate) {
    // Ø¹Ø±Ø¶ Ø§Ù„Ù€ Modal
    document.getElementById('editTaskModal').style.display = 'block';
    
    // Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    document.getElementById('edit_task_title').value = title;
    document.getElementById('edit_task_description').value = description;
    document.getElementById('edit_task_project').value = projectId || '';
    document.getElementById('edit_task_assignee').value = assigneeId || '';
    document.getElementById('edit_task_status').value = status;
    document.getElementById('edit_task_due_date').value = dueDate;
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù€ action Ù„Ù„Ù€ form
    const form = document.getElementById('editTaskForm');
    form.action = `/tasks/${taskId}/edit/`;
}

// Ø¥ØºÙ„Ø§Ù‚ Modal ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©
function closeEditTaskModal() {
    document.getElementById('editTaskModal').style.display = 'none';
}

// ========== Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø© ==========

// ÙØªØ­ Modal Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©
function openDeleteTaskModal(taskId, taskTitle) {
    // Ø¹Ø±Ø¶ Ø§Ù„Ù€ Modal
    document.getElementById('deleteTaskModal').style.display = 'block';
    
    // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©
    document.getElementById('delete_task_name').textContent = taskTitle;
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù€ action Ù„Ù„Ù€ form
    const form = document.getElementById('deleteTaskForm');
    form.action = `/tasks/${taskId}/delete/`;
}

// Ø¥ØºÙ„Ø§Ù‚ Modal Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©
function closeDeleteTaskModal() {
    document.getElementById('deleteTaskModal').style.display = 'none';
}

// ========== ØªØ­Ø¯ÙŠØ«: Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø£ÙŠ Modal ==========
window.onclick = function(event) {
    const editProjectModal = document.getElementById('editProjectModal');
    const deleteProjectModal = document.getElementById('deleteProjectModal');
    const viewTaskModal = document.getElementById('viewTaskModal');
    const addProjectModal = document.getElementById('addProjectModal');
    const addTaskModal = document.getElementById('addTaskModal');
    const editTaskModal = document.getElementById('editTaskModal');
    const deleteTaskModal = document.getElementById('deleteTaskModal');
    
    if (event.target == editProjectModal) {
        closeEditModal();
    }
    if (event.target == deleteProjectModal) {
        closeDeleteModal();
    }
    if (event.target == viewTaskModal) {
        closeViewTaskModal();
    }
    if (event.target == addProjectModal) {
        closeAddProjectModal();
    }
    if (event.target == addTaskModal) {
        closeAddTaskModal();
    }
    if (event.target == editTaskModal) {
        closeEditTaskModal();
    }
    if (event.target == deleteTaskModal) {
        closeDeleteTaskModal();
    }
}


// ================== Employee Charts ==================
{% if role != "manager" %}

const tasksStatusCanvas = document.getElementById('tasksStatusChart');
if (tasksStatusCanvas) {
    const tasksStatusChart = new Chart(tasksStatusCanvas, {
        type: 'doughnut',
        data: {
            labels: [
                'To Do ({{ todo_tasks }})',
                'In Progress ({{ in_progress_tasks }})',
                'Under Review ({{ under_review_tasks }})', 
                'Blocked ({{ blocked_tasks }})',
                'Completed ({{ completed_tasks }})',
                'Late ({{ overdue_tasks }})'
            ],
            datasets: [{
                data: [
                    {{ todo_tasks }},
                    {{ in_progress_tasks }},
                    {{ under_review_tasks }},
                    {{ blocked_tasks }},
                    {{ completed_tasks }},
                    {{ overdue_tasks }}
                ],
                backgroundColor: [
                    '#6b7280',  // To Do
                    '#3b82f6',  // In Progress
                    '#eab308',  // Under Review
                    '#f59e0b',  // Blocked
                    '#22c55e',  // Completed
                    '#ef4444'   // Late
                ],
                borderWidth: 0
            }]
        },
        options: {
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom',
                    labels: {
                        boxWidth: 14,
                        boxHeight: 14,
                        padding: 12,
                        usePointStyle: false,
                        pointStyle: 'circle',
                        color: '#ffffff',
                        font: {
                            family: 'Cairo',
                            size: 13,
                            weight: '600'
                        }
                    }
                }
            },
                cutout: '60%'
        }
    });
}


const workloadCanvas = document.getElementById('workloadChart');
if (workloadCanvas) {
    const activeTasks = {{ workload |default:0 }};
    const capacity = {{ workload_capacity |default:10 }};
    const free = Math.max(capacity - activeTasks, 0);

    const workloadChart = new Chart(workloadCanvas, {
        type: 'doughnut',
        data: {
            labels: ['Used', 'Free'],
            datasets: [{
                data: [activeTasks, free],
                backgroundColor: ['#22c55e', 'rgba(255,255,255,0.08)'],
                borderWidth: 0
            }]
        },
        options: {
            plugins: {
                legend: { display: false }
            },
            cutout: '75%'
        }
    });
}

{% endif %}



    </script>


{% endblock %}